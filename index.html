<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RK KNIT FAB — Admin Fabric Entry</title>
<style>
  :root{
    --bg:#f8f8fb; --card:#fff; --border:#e5e7eb; --ink:#111; --muted:#777;
    --primary:#111; --shadow:0 4px 20px rgba(0,0,0,.06);
  }
  *{box-sizing:border-box;font-family:Inter,system-ui}
  body{margin:0;background:var(--bg);color:var(--ink)}
  header{padding:18px 20px;background:var(--card);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:40}
  .title{font-weight:700;font-size:22px}
  .container{max-width:900px;margin:0 auto;padding:20px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px;margin-bottom:20px;box-shadow:var(--shadow)}
  .input,select,textarea{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:10px;font-size:15px}
  .input:focus,textarea:focus,select:focus{outline:none;border-color:var(--primary)}
  .row{display:flex;gap:10px;align-items:center}
  .wrap{flex-wrap:wrap}
  .btn{padding:10px 18px;border-radius:10px;border:0;background:var(--primary);color:#fff;font-size:15px;cursor:pointer}
  .btn-outline{background:#fff;color:var(--primary);border:1px solid var(--border)}
  .pill{background:#f1f1f4;padding:6px 10px;border-radius:999px;font-size:13px;border:1px solid var(--border)}
  .section-title{font-size:18px;font-weight:600;margin:10px 0}
  @media(max-width:600px){ .row{flex-direction:column;align-items:flex-start} }
</style>
</head>
<body>
<header>
  <div class="title">RK KNIT FAB — Admin</div>
  <div style="font-size:13px;color:var(--muted)">Add / Edit / Delete Fabrics</div>
</header>

<div class="container">

  <div class="card">
    <div class="section-title">Fabric Details</div>
    <div class="row">
      <div style="flex:1">
        <label>Name</label>
        <input id="name" class="input" />
      </div>
      <div style="flex:1">
        <label>Category</label>
        <input id="category" class="input" />
      </div>
    </div>

    <div class="row">
      <div style="flex:1">
        <label>GSM</label>
        <input id="gsm" type="number" class="input" />
      </div>
    </div>

    <label>Description</label>
    <textarea id="description" rows="3" class="input"></textarea>

    <div class="section-title">Characteristics</div>
    <div class="row">
      <input id="charInput" class="input" placeholder="Add characteristic" />
      <button class="btn-outline" id="addChar">Add</button>
    </div>
    <div id="chars" class="row wrap" style="margin-top:10px"></div>

    <div class="section-title">Applications</div>
    <div class="row">
      <input id="appInput" class="input" placeholder="Add application" />
      <button class="btn-outline" id="addApp">Add</button>
    </div>
    <div id="apps" class="row wrap" style="margin-top:10px"></div>

    <div class="section-title">Media Upload</div>
    <input id="files" type="file" multiple accept="image/*,video/*" />
    <div id="uploadStatus" style="font-size:13px;color:var(--muted);margin-top:6px"></div>
    <div id="mediaPreview" class="row wrap" style="margin-top:10px"></div>

    <div class="row" style="margin-top:16px">
      <button class="btn" id="saveBtn">Save</button>
      <button class="btn-outline" id="clearBtn">Clear</button>
    </div>
  </div>

  <div class="card">
    <div class="section-title">Existing Fabrics</div>
    <input id="searchAdm" class="input" placeholder="Search fabric…" />
    <div id="table"></div>
  </div>

</div>

<script>
// ===== CONFIG =====
const API = "https://script.google.com/macros/s/AKfycbxtXSQZp9Ur6wMargr8eUi5oyw99y4jRDz4j7Sx2OBSmIMFxcRwvoVv9bZcYqDWbbn2/exec";

// ===== STATE =====
let chars = [];
let apps = [];
let media = [];
let editingId = null;

const $ = q => document.querySelector(q);

// Add characteristic\$('#addChar').onclick = () => {
  const v = \$('#charInput').value.trim();
  if(v && !chars.includes(v)){ chars.push(v); renderTags(); }
  \$('#charInput').value = "";
};

// Add application\$('#addApp').onclick = () => {
  const v = \$('#appInput').value.trim();
  if(v && !apps.includes(v)){ apps.push(v); renderTags(); }
  \$('#appInput').value = "";
};

function renderTags(){
  \$('#chars').innerHTML = chars.map(c => `<span class='pill'>${c}</span>`).join('');
  \$('#apps').innerHTML = apps.map(a => `<span class='pill'>${a}</span>`).join('');
  \$('#mediaPreview').innerHTML = media.map(m => `<img src='${m}' style='width:100px;height:80px;object-fit:cover;border-radius:8px'/>`).join('');
}

// Upload files
\$('#files').onchange = async () => {
  if(!\$('#files').files.length) return;
  \$('#uploadStatus').textContent = "Uploading…";
  const fd = new FormData();
  [...\$('#files').files].forEach(f => fd.append("file", f));
  const r = await fetch(`${API}?fn=upload`, { method:"POST", body:fd });
  const j = await r.json();
  if(j.urls) media = media.concat(j.urls);
  renderTags();
  \$('#uploadStatus').textContent = "";
};

// Save fabric
\$('#saveBtn').onclick = async () => {
  const payload = {
    id: editingId,
    name: \$('#name').value.trim(),
    category: \$('#category').value.trim(),
    gsm: \$('#gsm').value.trim(),
    description: \$('#description').value.trim(),
    characteristics: chars,
    applications: apps,
    media: media
  };

  await fetch(`${API}?fn=${editingId?"update":"create"}`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(payload)
  });

  clearForm();
  load();
};

// Clear form
\$('#clearBtn').onclick = clearForm;
function clearForm(){
  editingId=null;
  \$('#name').value="";
  \$('#category').value="";
  \$('#gsm').value="";
  \$('#description').value="";
  chars=[]; apps=[]; media=[];
  renderTags();
}

// Load table
async function load(){
  const r = await fetch(`${API}?fn=list`);
  const j = await r.json();
  renderTable(j.data||[]);
}

function renderTable(list){
  const q = \$('#searchAdm').value.toLowerCase();
  list = list.filter(x => x.name.toLowerCase().includes(q) || x.category.toLowerCase().includes(q));

  \$('#table').innerHTML = list.map(i => `
    <div class='card' style='padding:12px'>
      <div class='row space'>
        <strong>${i.name}</strong>
        <button class='btn-outline' onclick='editItem("${i.id}")'>Edit</button>
      </div>
      <div style='font-size:13px;color:var(--muted)'>${i.category}</div>
    </div>
  `).join('');
}

window.editItem = function(id){
  editingId = id;
  fetch(`${API}?fn=list`).then(r=>r.json()).then(j=>{
    const it = (j.data||[]).find(x=>x.id==id);
    \$('#name').value=it.name;
    \$('#category').value=it.category;
    \$('#gsm').value=it.gsm;
    \$('#description').value=it.description;
    chars = it.characteristics||[];
    apps = it.applications||[];
    media = it.media||[];
    renderTags();
    window.scrollTo({top:0,behavior:"smooth"});
  });
};

\$('#searchAdm').oninput = load;
load();
</script>

</body>
</html>
